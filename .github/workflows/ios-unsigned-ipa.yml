name: iOS Unsigned IPA (for AltStore)
on: [workflow_dispatch, push]
jobs:
  build-unsigned-ipa:
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4
      - name: Install XcodeGen
        run: brew install xcodegen
      - name: Generate Xcode project
        run: |
          cd ChatStyleKeyboard-iOS
          xcodegen generate
      - name: Build (unsigned .app)
        run: |
          cd ChatStyleKeyboard-iOS
          xcodebuild -scheme ChatStyleKeyboard -project ChatStyleKeyboard.xcodeproj -configuration Release -destination 'generic/platform=iOS' CODE_SIGNING_ALLOWED=NO build
      - name: Package .ipa (unsigned)
        run: |
          cd ChatStyleKeyboard-iOS
          APP_PATH=$(find ./build -name ChatStyleKeyboard.app -type d | head -n 1)
          if [ -z "$APP_PATH" ]; then
            APP_PATH=$(find ./ -name ChatStyleKeyboard.app -type d | head -n 1)
          fi
          mkdir -p Payload
          cp -R "$APP_PATH" Payload/
          zip -r ChatStyleKeyboard-unsigned.ipa Payload
      - name: Upload IPA
        uses: actions/upload-artifact@v4
        with:
          name: ChatStyleKeyboard-unsigned
          path: ChatStyleKeyboard-iOS/ChatStyleKeyboard-unsigned.ipa
